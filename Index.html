<!DOCTYPE html>
<html>
<head>
    <title>3Cäº§å“ä»·æ ¼ç›‘æµ‹</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 30px; 
            text-align: center; 
            position: relative;
        }
        .header h1 { margin: 0; font-size: 2.5em; font-weight: 600; }
        .header p { margin: 10px 0 0 0; opacity: 0.9; font-size: 1.1em; }
        
        /* ç®¡ç†å‘˜é…ç½®å…¥å£ */
        .admin-config-link {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .admin-config-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .search-section { 
            padding: 25px; 
            background: var(--light-color); 
            border-bottom: 1px solid #e9ecef; 
        }
        
        .search-container { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            max-width: 800px; 
            margin: 0 auto; 
            flex-direction: column; 
            align-items: stretch; 
        }
        
        .brand-tags { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            margin-bottom: 15px; 
            justify-content: center; 
        }
        
        .brand-tag { 
            padding: 8px 16px; 
            background: #e9ecef; 
            border-radius: 20px; 
            cursor: pointer; 
            font-size: 14px; 
            transition: all 0.3s; 
            border: 1px solid #dee2e6; 
        }
        
        .brand-tag:hover { 
            background: #dee2e6; 
            transform: translateY(-2px); 
        }
        
        .brand-tag.active { 
            background: var(--primary-color); 
            color: white; 
            border-color: var(--primary-color); 
        }
        
        .search-input-container { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
        }
        
        .search-input { 
            flex: 1; 
            padding: 14px 18px; 
            font-size: 16px; 
            border: 2px solid #ddd; 
            border-radius: var(--border-radius); 
            outline: none; 
            transition: border-color 0.3s; 
        }
        
        .search-input:focus { 
            border-color: var(--primary-color); 
        }
        
        .search-btn { 
            padding: 14px 24px; 
            background: var(--primary-color); 
            color: white; 
            border: none; 
            border-radius: var(--border-radius); 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 500; 
            transition: background 0.3s; 
        }
        
        .search-btn:hover { 
            background: #0056b3; 
        }
        
        .product-suggestions { 
            position: absolute; 
            top: 100%; 
            left: 0; 
            right: 0; 
            background: white; 
            border: 1px solid #ddd; 
            border-top: none; 
            border-radius: 0 0 var(--border-radius) var(--border-radius); 
            max-height: 300px; 
            overflow-y: auto; 
            z-index: 1000; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        
        .suggestion-item { 
            padding: 12px 16px; 
            cursor: pointer; 
            border-bottom: 1px solid #f0f0f0; 
        }
        
        .suggestion-item:hover { 
            background-color: #f8f9fa; 
        }
        
        .suggestion-item:last-child { 
            border-bottom: none; 
        }
        
        .suggestion-category { 
            font-weight: bold; 
            color: var(--primary-color); 
            padding: 8px 16px; 
            background-color: #f8f9fa; 
            border-bottom: 1px solid #e9ecef; 
        }
        
        .search-input-container { 
            position: relative; 
        }
        
        .tabs { 
            margin: 0; 
            padding: 0; 
            background: #e9ecef; 
        }
        
        .tab-links { 
            list-style-type: none; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            justify-content: center; 
        }
        
        .tab-links li { 
            display: inline-block; 
            margin: 0; 
        }
        
        .tab-links a { 
            display: block; 
            padding: 16px 28px; 
            background: #e9ecef; 
            text-decoration: none; 
            color: #495057; 
            border-right: 1px solid #dee2e6; 
            transition: all 0.3s; 
            font-weight: 500; 
            position: relative; 
        }
        
        .tab-links a:last-child { 
            border-right: none; 
        }
        
        .tab-links a:hover { 
            background: #dee2e6; 
        }
        
        .tab-links a.active { 
            background: white; 
            color: var(--primary-color); 
            font-weight: bold; 
        }
        
        .tab-links a.active::after { 
            content: ''; 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            height: 3px; 
            background: var(--primary-color); 
        }
        
        .tab { 
            display: none; 
            padding: 30px; 
        }
        
        .tab.active { 
            display: block; 
        }
        
        .results { 
            margin-top: 20px; 
        }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: var(--border-radius); 
            box-shadow: var(--box-shadow); 
            text-align: center; 
            border: 1px solid #e9ecef; 
            transition: transform 0.2s; 
        }
        
        .stat-card:hover { 
            transform: translateY(-3px); 
        }
        
        .stat-card h3 { 
            margin: 0 0 10px 0; 
            color: #6c757d; 
            font-size: 1em; 
            font-weight: 500; 
        }
        
        .stat-card .value { 
            font-size: 2em; 
            font-weight: bold; 
            color: var(--primary-color); 
        }
        
        .market-insight { 
            background: #e7f3ff; 
            border-left: 4px solid var(--primary-color); 
            padding: 18px; 
            margin: 20px 0; 
            border-radius: 0 var(--border-radius) var(--border-radius) 0; 
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
            background: white; 
            border-radius: var(--border-radius); 
            overflow: hidden; 
            box-shadow: var(--box-shadow); 
        }
        
        th, td { 
            padding: 14px; 
            text-align: left; 
            border-bottom: 1px solid #eee; 
        }
        
        th { 
            background-color: #f8f9fa; 
            font-weight: 600; 
            color: #495057; 
        }
        
        tbody tr:hover { 
            background-color: #f8f9fa; 
        }
        
        .platform-color { 
            display: inline-block; 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            margin-right: 8px; 
        }
        
        .tmall { background-color: #ff4444; }
        .jd { background-color: #e96015; }
        .pdd { background-color: #f21639; }
        .douyin { background-color: #ff467b; }
        .offline { background-color: #6c757d; }
        
        .price-low { color: var(--success-color); font-weight: bold; }
        .price-medium { color: var(--warning-color); font-weight: bold; }
        .price-high { color: var(--danger-color); font-weight: bold; }
        
        .availability-badge { 
            display: inline-block; 
            padding: 4px 10px; 
            border-radius: 20px; 
            font-size: 0.8em; 
            font-weight: 500; 
        }
        
        .available { background: #d4edda; color: #155724; }
        .out-of-stock { background: #f8d7da; color: #721c24; }
        .preorder { background: #fff3cd; color: #856404; }
        
        .chart-container { 
            margin: 30px 0; 
            height: 500px; 
            background: white; 
            border-radius: var(--border-radius); 
            padding: 20px; 
            box-shadow: var(--box-shadow); 
        }
        
        .loading { 
            text-align: center; 
            padding: 50px; 
            color: #6c757d; 
            font-size: 1.1em; 
        }
        
        .loading::after { 
            content: ''; 
            display: inline-block; 
            width: 16px; 
            height: 16px; 
            border: 2px solid #ccc; 
            border-top-color: var(--primary-color); 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-left: 10px; 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        .last-updated { 
            font-size: 0.9em; 
            color: #6c757d; 
            margin-left: 15px; 
        }
        
        .btn-primary { background: var(--primary-color) !important; }
        .btn-secondary { background: var(--secondary-color) !important; }
        
        @media (max-width: 768px) {
            .search-container { 
                flex-direction: column; 
            }
            
            .tab-links { 
                flex-direction: column; 
            }
            
            .tab-links a { 
                border-right: none; 
                border-bottom: 1px solid #dee2e6; 
            }
            
            .stats-grid { 
                grid-template-columns: 1fr; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š 3Cäº§å“ä»·æ ¼ç›‘æµ‹</h1>
            <p>å¤šå“ç‰Œã€å¤šå¹³å°å®æ—¶ä»·æ ¼ç›‘æµ‹ï¼ŒåŠ¨æ€è°ƒæ•´æ“ç›˜ç­–ç•¥ï¼Œé«˜æ•ˆå¸‚åœºç§©åºç®¡ç†</p>
            <!-- ç®¡ç†å‘˜é…ç½®å…¥å£ -->
            <a href="admin.html" class="admin-config-link" title="ç®¡ç†å‘˜é…ç½®">
                âš™ï¸ ç®¡ç†å‘˜é…ç½®
            </a>
        </div>
        
        <div class="search-section">
            <div class="search-container">
                <div class="brand-tags">
                    <div class="brand-tag active" data-brand="å…¨éƒ¨">å…¨éƒ¨</div>
                    <div class="brand-tag" data-brand="åä¸º">åä¸º</div> 
                   <div class="brand-tag" data-brand="è‹¹æœ">è‹¹æœ</div>
                    <div class="brand-tag" data-brand="å°ç±³">å°ç±³</div>
                    <div class="brand-tag" data-brand="è£è€€">è£è€€</div>
                    <div class="brand-tag" data-brand="OPPO">OPPO</div>
                    <div class="brand-tag" data-brand="vivo">vivo</div>
                    <div class="brand-tag" data-brand="ä¸‰æ˜Ÿ">ä¸‰æ˜Ÿ</div>
                    <div class="brand-tag" data-brand="è”æƒ³">è”æƒ³</div>
                </div>
                
                <div class="search-input-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="è¯·é€‰æ‹©å“ç‰Œæˆ–ç›´æ¥è¾“å…¥æœç´¢">
                    <div id="productSuggestions" class="product-suggestions" style="display: none;"></div>
                </div>
                
                <div style="display: flex; justify-content: center; margin-top: 10px;">
                    <button class="search-btn" onclick="performAction()">ğŸ” æŸ¥è¯¢</button>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <ul class="tab-links">
                <li><a href="#" class="tab-link active" data-tab="monitor">ä»·æ ¼ç›‘æ§</a></li>
                <li><a href="#" class="tab-link" data-tab="compare">ç«å“å¯¹æ¯”</a></li>
                <li><a href="#" class="tab-link" data-tab="history">ä»·æ ¼è¶‹åŠ¿</a></li>
                <li><a href="#" class="tab-link" data-tab="report">å¸‚åœºæŠ¥å‘Š</a></li>
            </ul>
        </div>
        
        <div id="monitor" class="tab active">
            <h2>ä»·æ ¼ç›‘æ§ç»“æœ <span id="lastUpdatedMonitor" class="last-updated"></span></h2>
            <div id="priceResults"></div>
        </div>
        
        <div id="compare" class="tab">
            <h2>äº§å“å¯¹æ¯”</h2>
            <div id="compareResults"></div>
        </div>
        
        <div id="history" class="tab">
            <h2>ä»·æ ¼è¶‹åŠ¿åˆ†æ</h2>
            <div id="historyChart" class="chart-container"></div>
        </div>
        
        <div id="report" class="tab">
            <h2>å¸‚åœºä»·æ ¼æŠ¥å‘Š</h2>
            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        // å­˜å‚¨æœ€åæ›´æ–°æ—¶é—´
        let lastUpdateTimes = {};
        
        // ä»·æ ¼æ•°æ®å­˜å‚¨ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“ï¼‰
        let priceDatabase = {};
        
        // å½“å‰æ¿€æ´»çš„tab
        let currentTab = 'monitor';
        
        // å½“å‰é€‰ä¸­çš„å“ç‰Œ
        let currentBrand = 'å…¨éƒ¨';
        
        // ä¸»æµå“ç‰Œå’Œäº§å“æ•°æ®
        const productData = {
            "è‹¹æœ": ["iPhone17", "iPhone16", "iPhone15", "iPhone14", "iPad Pro", "iPad Air", "MacBook Pro", "MacBook Air", "AirPods Pro", "Apple Watch Series 9"],
            "åä¸º": ["åä¸ºMate60", "åä¸ºMate50", "åä¸ºP60", "åä¸ºP50", "åä¸ºNova12", "åä¸ºNova11", "åä¸ºFreeBuds Pro", "åä¸ºWatch GT 4", "åä¸ºMatePad Pro", "åä¸ºFreeClip"],
            "å°ç±³": ["å°ç±³14", "å°ç±³13", "å°ç±³12", "Redmi K70", "Redmi K60", "å°ç±³å¹³æ¿6", "å°ç±³æ‰‹ç¯8", "å°ç±³è€³æœº", "å°ç±³è·¯ç”±å™¨", "å°ç±³ç©ºæ°”å‡€åŒ–å™¨"],
            "è£è€€": ["è£è€€Magic6", "è£è€€Magic5", "è£è€€X50", "è£è€€X40", "è£è€€å¹³æ¿9", "è£è€€æ‰‹è¡¨", "è£è€€è€³æœº", "è£è€€è·¯ç”±", "è£è€€MagicBook", "è£è€€äº²é€‰"],
            "OPPO": ["OPPO Find N3", "OPPO Find X6", "OPPO Reno11", "OPPO Reno10", "ä¸€åŠ 12", "ä¸€åŠ 11", "OPPO Watch", "OPPO Enco", "OPPO Pad", "OPPO Aç³»åˆ—"],
            "vivo": ["vivo X100", "vivo X90", "vivo S18", "vivo S17", "iQOO 12", "iQOO 11", "vivo TWS", "vivo Watch", "vivo Pad", "vivo Yç³»åˆ—"],
            "ä¸‰æ˜Ÿ": ["ä¸‰æ˜ŸGalaxy S24", "ä¸‰æ˜ŸGalaxy S23", "ä¸‰æ˜ŸGalaxy Z Fold5", "ä¸‰æ˜ŸGalaxy Z Flip5", "ä¸‰æ˜ŸNote23", "ä¸‰æ˜ŸTab S9", "ä¸‰æ˜ŸBuds2 Pro", "ä¸‰æ˜ŸWatch6", "ä¸‰æ˜Ÿç¬”è®°æœ¬", "ä¸‰æ˜Ÿæ˜¾ç¤ºå™¨"],
            "è”æƒ³": ["è”æƒ³ThinkPad X1", "è”æƒ³ThinkPad T14", "è”æƒ³æ‹¯æ•‘è€…", "è”æƒ³å°æ–°Pro", "è”æƒ³YOGA", "è”æƒ³å¹³æ¿", "è”æƒ³å°å¼æœº", "è”æƒ³æ˜¾ç¤ºå™¨", "è”æƒ³æ‰“å°æœº", "è”æƒ³æ‘„åƒå¤´"]
        };
        
        // ç”Ÿæˆå®æ—¶ä»·æ ¼æ•°æ®çš„å‡½æ•°
        function generateRealtimeData(productName) {
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰è¯¥äº§å“çš„æ•°æ®
            if (!priceDatabase[productName]) {
                // å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºåˆå§‹æ•°æ®
                priceDatabase[productName] = generateMockData(productName);
            }
            
            // æ›´æ–°æ—¶é—´æˆ³
            const updateTime = new Date().toLocaleString();
            lastUpdateTimes[productName] = updateTime;
            
            // æ›´æ–°ç°æœ‰æ•°æ®ï¼ˆæ¨¡æ‹Ÿä»·æ ¼æ³¢åŠ¨ï¼‰
            priceDatabase[productName] = priceDatabase[productName].map(item => {
                // éšæœºä»·æ ¼æ³¢åŠ¨ï¼ˆÂ±2%ï¼‰
                const priceChange = (Math.random() - 0.5) * 0.04; // Â±2%æ³¢åŠ¨
                const newFinalPrice = item.final_price * (1 + priceChange);
                
                // éšæœºåº“å­˜å˜åŒ–
                const availabilityOptions = ["æœ‰è´§", "æœ‰è´§", "æœ‰è´§", "ç¼ºè´§", "é¢„è®¢"];
                const newAvailability = availabilityOptions[Math.floor(Math.random() * availabilityOptions.length)];
                
                // éšæœºä¿ƒé”€å˜åŒ–
                const promotions = [
                    "æ»¡1000å‡100", "æ»¡500å‡50", "ç«‹å‡200å…ƒ", "ç«‹å‡100å…ƒ", 
                    "æŠ˜æ‰£95æŠ˜", "æŠ˜æ‰£98æŠ˜", "èµ ä»·å€¼200å…ƒç¤¼å“", "èµ ä»·å€¼100å…ƒç¤¼å“", 
                    "ä»¥æ—§æ¢æ–°è¡¥è´´300å…ƒ", "ä»¥æ—§æ¢æ–°è¡¥è´´200å…ƒ", "åˆ†æœŸå…æ¯12æœŸ", "æ— ä¿ƒé”€"
                ];
                const newPromotion = promotions[Math.floor(Math.random() * promotions.length)];
                
                return {
                    ...item,
                    final_price: parseFloat(newFinalPrice.toFixed(2)),
                    availability: newAvailability,
                    promotion: newPromotion,
                    timestamp: updateTime
                };
            });
            
            return priceDatabase[productName];
        }
        
        // ç”Ÿæˆåˆå§‹æ¨¡æ‹Ÿæ•°æ®çš„å‡½æ•°
        function generateMockData(productName) {
            // åŸºç¡€ä»·æ ¼æ˜ å°„
            const basePrices = {
                "iPhone17": 7999,
                "iPhone16": 6999,
                "iPhone15": 5999,
                "åä¸ºMate60": 4999,
                "åä¸ºP60": 4499,
                "å°ç±³14": 3999,
                "å°ç±³13": 3499,
                "è£è€€Magic6": 4199,
                "OPPO Find N3": 6999,
                "vivo X100": 4999,
                "ä¸‰æ˜ŸGalaxy S24": 6999,
                "è”æƒ³ThinkPad X1": 12999,
                "iPad Pro": 8999,
                "MacBook Pro": 14999,
                "AirPods Pro": 1999,
                "Apple Watch Series 9": 2999,
                "åä¸ºFreeBuds Pro": 1299,
                "å°ç±³æ‰‹ç¯8": 299,
                "è£è€€X50": 1399,
                "ä¸€åŠ 12": 4499,
                "iQOO 12": 3899,
                "ä¸‰æ˜ŸGalaxy Z Fold5": 13999,
                "è”æƒ³æ‹¯æ•‘è€…": 7999
            };
            
            // å“ç‰Œæ˜ å°„
            const brandMap = {
                "iPhone": "è‹¹æœ",
                "åä¸º": "åä¸º",
                "å°ç±³": "å°ç±³",
                "è£è€€": "è£è€€",
                "OPPO": "Oppo",
                "vivo": "Vivo",
                "ä¸‰æ˜Ÿ": "ä¸‰æ˜Ÿ",
                "è”æƒ³": "è”æƒ³"
            };
            
            // è·å–å“ç‰Œ
            let brand = "æœªçŸ¥å“ç‰Œ";
            for (const [key, value] of Object.entries(brandMap)) {
                if (productName.includes(key)) {
                    brand = value;
                    break;
                }
            }
            
            // è·å–åŸºç¡€ä»·æ ¼
            const basePrice = basePrices[productName] || 3999; // é»˜è®¤ä»·æ ¼
            
            // ç”Ÿæˆä¸åŒå¹³å°çš„ä»·æ ¼æ•°æ®
            const platforms = [
                {name: "äº¬ä¸œ", store: "å®˜æ–¹æ——èˆ°åº—"},
                {name: "å¤©çŒ«", store: "å®˜æ–¹æ——èˆ°åº—"},
                {name: "æ‹¼å¤šå¤š", store: "ç¬¬ä¸‰æ–¹åº—é“º"},
                {name: "æŠ–éŸ³", store: "å®˜æ–¹æ——èˆ°åº—"},
                {name: "çº¿ä¸‹", store: "ç›´è¥åº—"},
                {name: "çº¿ä¸‹", store: "ä½“éªŒåº—"}
            ];
            
            const promotions = [
                "æ»¡1000å‡100", "æ»¡500å‡50", "ç«‹å‡200å…ƒ", "ç«‹å‡100å…ƒ", 
                "æŠ˜æ‰£95æŠ˜", "æŠ˜æ‰£98æŠ˜", "èµ ä»·å€¼200å…ƒç¤¼å“", "èµ ä»·å€¼100å…ƒç¤¼å“", 
                "ä»¥æ—§æ¢æ–°è¡¥è´´300å…ƒ", "ä»¥æ—§æ¢æ–°è¡¥è´´200å…ƒ", "åˆ†æœŸå…æ¯12æœŸ", "æ— ä¿ƒé”€"
            ];
            
            const availabilityOptions = ["æœ‰è´§", "æœ‰è´§", "æœ‰è´§", "ç¼ºè´§", "é¢„è®¢"];
            
            const result = [];
            platforms.forEach((platform, index) => {
                // ä»·æ ¼æ³¢åŠ¨
                const priceVariation = (Math.random() - 0.5) * 0.1; // Â±5%æ³¢åŠ¨
                const originalPrice = basePrice * (1 + priceVariation);
                
                // æŠ˜æ‰£
                const discount = 1 - Math.random() * 0.15; // æœ€å¤š15%æŠ˜æ‰£
                const finalPrice = originalPrice * discount;
                
                result.push({
                    platform: platform.name,
                    store_type: platform.store,
                    brand: brand,
                    original_price: parseFloat(originalPrice.toFixed(2)),
                    promotion: promotions[Math.floor(Math.random() * promotions.length)],
                    final_price: parseFloat(finalPrice.toFixed(2)),
                    availability: availabilityOptions[Math.floor(Math.random() * availabilityOptions.length)],
                    timestamp: new Date().toLocaleString()
                });
            });
            
            return result;
        }
        
        // ç”Ÿæˆå†å²ä»·æ ¼æ•°æ®çš„å‡½æ•°
        function generateHistoryData(productName) {
            const basePrice = {
                "iPhone17": 7999,
                "iPhone16": 6999,
                "åä¸ºMate60": 4999,
                "å°ç±³14": 3999
            }[productName] || 3999;
            
            const result = [];
            const now = new Date();
            
            // ç”Ÿæˆè¿‡å»30å¤©çš„æ•°æ®
            for (let i = 30; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                
                // ä»·æ ¼æ³¢åŠ¨
                const priceVariation = (Math.random() - 0.5) * 0.1;
                const price = basePrice * (1 + priceVariation);
                
                result.push({
                    timestamp: date.toISOString().split('T')[0],
                    final_price: parseFloat(price.toFixed(2)),
                    platform: ["äº¬ä¸œ", "å¤©çŒ«", "æ‹¼å¤šå¤š"][Math.floor(Math.random() * 3)],
                    store_type: "å®˜æ–¹æ——èˆ°åº—"
                });
            }
            
            return result;
        }
        
        // Tabåˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const tabId = this.getAttribute('data-tab');
                
                // éšè—æ‰€æœ‰tab
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // ç§»é™¤æ‰€æœ‰é“¾æ¥çš„activeç±»
                document.querySelectorAll('.tab-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                // æ˜¾ç¤ºé€‰ä¸­çš„tabå¹¶æ¿€æ´»é“¾æ¥
                document.getElementById(tabId).classList.add('active');
                this.classList.add('active');
                
                // æ›´æ–°å½“å‰tab
                currentTab = tabId;
                
                // å¦‚æœæ˜¯ä»·æ ¼ç›‘æ§tabï¼Œè‡ªåŠ¨æŸ¥è¯¢å½“å‰äº§å“
                if (tabId === 'monitor') {
                    performAction();
                }
            });
        });
        
        // å“ç‰Œæ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.brand-tag').forEach(tag => {
            tag.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
                document.querySelectorAll('.brand-tag').forEach(t => {
                    t.classList.remove('active');
                });
                
                // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                this.classList.add('active');
                
                // æ›´æ–°å½“å‰å“ç‰Œ
                currentBrand = this.getAttribute('data-brand');
                
                // æ˜¾ç¤ºè¯¥å“ç‰Œä¸‹çš„äº§å“å»ºè®®
                if (currentBrand === 'å…¨éƒ¨') {
                    showAllProductSuggestions();
                } else {
                    showBrandProductSuggestions(currentBrand);
                }
            });
        });
        
        // äº§å“é€‰æ‹©åŠŸèƒ½
        function setupProductSuggestions() {
            const searchInput = document.getElementById('searchInput');
            const suggestionsContainer = document.getElementById('productSuggestions');
            
            // æ˜¾ç¤ºå½“å‰å“ç‰Œçš„äº§å“å»ºè®®
            searchInput.addEventListener('focus', function() {
                if (currentBrand === 'å…¨éƒ¨') {
                    showAllProductSuggestions();
                } else {
                    showBrandProductSuggestions(currentBrand);
                }
            });
            
            // ç‚¹å‡»è¾“å…¥æ¡†å¤–éƒ¨éšè—å»ºè®®
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
            
            // è¾“å…¥æ—¶è¿‡æ»¤å»ºè®®
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                if (query.trim() === '') {
                    if (currentBrand === 'å…¨éƒ¨') {
                        showAllProductSuggestions();
                    } else {
                        showBrandProductSuggestions(currentBrand);
                    }
                } else {
                    filterProductSuggestions(query);
                }
            });
            
            // å›è½¦é”®æ‰§è¡ŒæŸ¥è¯¢
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performAction();
                }
            });
        }
        
        function showAllProductSuggestions() {
            const suggestionsContainer = document.getElementById('productSuggestions');
            let html = '';
            for (const [brand, products] of Object.entries(productData)) {
                html += `<div class="suggestion-category">${brand}</div>`;
                products.forEach(product => {
                    html += `<div class="suggestion-item" onclick="selectProduct('${product}')">${product}</div>`;
                });
            }
            suggestionsContainer.innerHTML = html;
            suggestionsContainer.style.display = 'block';
        }
        
        function showBrandProductSuggestions(brand) {
            const suggestionsContainer = document.getElementById('productSuggestions');
            let html = '';
            if (productData[brand]) {
                html += `<div class="suggestion-category">${brand}</div>`;
                productData[brand].forEach(product => {
                    html += `<div class="suggestion-item" onclick="selectProduct('${product}')">${product}</div>`;
                });
            } else {
                html = `<div class="suggestion-item">æœªæ‰¾åˆ°è¯¥å“ç‰Œçš„äº§å“</div>`;
            }
            suggestionsContainer.innerHTML = html;
            suggestionsContainer.style.display = 'block';
        }
        
        function filterProductSuggestions(query) {
            const suggestionsContainer = document.getElementById('productSuggestions');
            let html = '';
            let hasResults = false;
            
            // æ ¹æ®å½“å‰å“ç‰Œè¿‡æ»¤
            const brandsToSearch = currentBrand === 'å…¨éƒ¨' ? Object.keys(productData) : [currentBrand];
            
            for (const brand of brandsToSearch) {
                if (productData[brand]) {
                    const filteredProducts = productData[brand].filter(product => 
                        product.toLowerCase().includes(query) || brand.toLowerCase().includes(query)
                    );
                    if (filteredProducts.length > 0) {
                        html += `<div class="suggestion-category">${brand}</div>`;
                        filteredProducts.forEach(product => {
                            html += `<div class="suggestion-item" onclick="selectProduct('${product}')">${product}</div>`;
                        });
                        hasResults = true;
                    }
                }
            }
            
            if (!hasResults) {
                html = `<div class="suggestion-item">æœªæ‰¾åˆ°åŒ¹é…çš„äº§å“</div>`;
            }
            
            suggestionsContainer.innerHTML = html;
            suggestionsContainer.style.display = 'block';
        }
        
        function selectProduct(productName) {
            document.getElementById('searchInput').value = productName;
            document.getElementById('productSuggestions').style.display = 'none';
            
            // è‡ªåŠ¨æ‰§è¡Œå½“å‰tabçš„æ“ä½œ
            performAction();
        }
        
        // æ‰§è¡Œå½“å‰tabå¯¹åº”çš„æ“ä½œ
        function performAction() {
            const searchInput = document.getElementById('searchInput').value;
            if (!searchInput) {
                alert('è¯·è¾“å…¥äº§å“åç§°');
                return;
            }
            
            switch(currentTab) {
                case 'monitor':
                    searchPrice(searchInput);
                    break;
                case 'compare':
                    compareProducts(searchInput);
                    break;
                case 'history':
                    showPriceHistory(searchInput);
                    break;
                case 'report':
                    generateReport(searchInput);
                    break;
            }
        }
        
        // æœç´¢ä»·æ ¼
        function searchPrice(productName) {
            showLoading('priceResults');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿï¼ˆæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼‰
            setTimeout(() => {
                const priceData = generateRealtimeData(productName);
                const data = {
                    product: productName,
                    price_data: priceData,
                    market_insight: generateMarketInsight(priceData)
                };
                
                displayPriceResults(data);
                
                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´æ˜¾ç¤º
                if (lastUpdateTimes[productName]) {
                    document.getElementById('lastUpdatedMonitor').textContent = `æœ€åæ›´æ–°: ${lastUpdateTimes[productName]}`;
                }
            }, 800); // å¢åŠ å»¶è¿Ÿä»¥æ¨¡æ‹ŸçœŸå®ç½‘ç»œè¯·æ±‚
        }
        
        function generateMarketInsight(priceData) {
            if (!priceData || priceData.length === 0) return "æš‚æ— æ•°æ®";
            
            const avgPrice = priceData.reduce((sum, item) => sum + item.final_price, 0) / priceData.length;
            const priceSpread = Math.max(...priceData.map(item => item.final_price)) - Math.min(...priceData.map(item => item.final_price));
            
            const insights = [];
            
            // ä»·æ ¼åˆ†å¸ƒåˆ†æ
            const lowPriced = priceData.filter(item => item.final_price < avgPrice * 0.95).length;
            const highPriced = priceData.filter(item => item.final_price > avgPrice * 1.05).length;
            
            if (lowPriced > priceData.length * 0.3) {
                insights.push("å¸‚åœºå­˜åœ¨è¾ƒå¤šä½ä»·ç«äº‰è€…");
            }
            if (highPriced > priceData.length * 0.3) {
                insights.push("å¸‚åœºå­˜åœ¨è¾ƒå¤šé«˜ä»·ç­–ç•¥è€…");
            }
            
            // ä¿ƒé”€æ´»åŠ¨åˆ†æ
            const promotionalItems = priceData.filter(item => 
                item.promotion.includes("æ»¡å‡") || 
                item.promotion.includes("ç«‹å‡") || 
                item.promotion.includes("æŠ˜")
            ).length;
            if (promotionalItems > priceData.length * 0.5) {
                insights.push("ä¿ƒé”€æ´»åŠ¨è¾ƒä¸ºé¢‘ç¹");
            }
            
            // åº“å­˜åˆ†æ
            const outOfStock = priceData.filter(item => item.availability === "ç¼ºè´§").length;
            if (outOfStock > priceData.length * 0.3) {
                insights.push("éƒ¨åˆ†å¹³å°åº“å­˜ç´§å¼ ");
            }
            
            return insights.length > 0 ? insights.join("ï¼›") : "å¸‚åœºè¡¨ç°å¹³ç¨³";
        }
        
        function displayPriceResults(data) {
            const container = document.getElementById('priceResults');
            if (!data.price_data || data.price_data.length === 0) {
                container.innerHTML = '<div class="loading">æœªæ‰¾åˆ°ç›¸å…³ä»·æ ¼æ•°æ®</div>';
                return;
            }
            
            const sortedData = [...data.price_data].sort((a, b) => a.final_price - b.final_price);
            const lowest = sortedData[0];
            const highest = sortedData[sortedData.length - 1];
            const avgPrice = data.price_data.reduce((sum, item) => sum + item.final_price, 0) / data.price_data.length;
            
            let html = '';
            
            // ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡
            html += `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æœ€ä½ä»·</h3>
                        <div class="value">Â¥${lowest.final_price.toFixed(2)}</div>
                        <div>${lowest.platform}-${lowest.store_type}</div>
                    </div>
                    <div class="stat-card">
                        <h3>æœ€é«˜ä»·</h3>
                        <div class="value">Â¥${highest.final_price.toFixed(2)}</div>
                        <div>${highest.platform}-${highest.store_type}</div>
                    </div>
                    <div class="stat-card">
                        <h3>å¹³å‡ä»·</h3>
                        <div class="value">Â¥${avgPrice.toFixed(2)}</div>
                        <div>å¸‚åœºå‡ä»·</div>
                    </div>
                    <div class="stat-card">
                        <h3>åœ¨å”®å•†å“</h3>
                        <div class="value">${data.price_data.filter(p => p.availability === 'æœ‰è´§').length}/${data.price_data.length}</div>
                        <div>å¯ç”¨/æ€»æ•°</div>
                    </div>
                </div>
            `;
            
            // å¸‚åœºæ´å¯Ÿ
            if (data.market_insight) {
                html += `<div class="market-insight"><strong>å¸‚åœºæ´å¯Ÿ:</strong> ${data.market_insight}</div>`;
            }
            
            html += '<h3>è¯¦ç»†ä»·æ ¼åˆ—è¡¨</h3>';
            html += '<table>';
            html += `
                <thead>
                    <tr>
                        <th>å¹³å°</th>
                        <th>åº—é“ºç±»å‹</th>
                        <th>å“ç‰Œ</th>
                        <th>åŸä»·</th>
                        <th>ä¿ƒé”€</th>
                        <th>åˆ°æ‰‹ä»·</th>
                        <th>åº“å­˜</th>
                        <th>æ—¶é—´</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            data.price_data.forEach(item => {
                const isLowest = item.final_price === lowest.final_price;
                const isHighest = item.final_price === highest.final_price;
                const priceClass = isLowest ? 'price-low' : isHighest ? 'price-high' : 'price-medium';
                
                let availabilityBadge = '';
                if (item.availability === 'æœ‰è´§') {
                    availabilityBadge = '<span class="availability-badge available">æœ‰è´§</span>';
                } else if (item.availability === 'ç¼ºè´§') {
                    availabilityBadge = '<span class="availability-badge out-of-stock">ç¼ºè´§</span>';
                } else {
                    availabilityBadge = '<span class="availability-badge preorder">é¢„è®¢</span>';
                }
                
                html += `
                    <tr>
                        <td>
                            <span class="platform-color ${item.platform.toLowerCase().replace('çº¿ä¸‹', 'offline')}" title="${item.platform}"></span>
                            ${item.platform}
                        </td>
                        <td>${item.store_type}</td>
                        <td>${item.brand}</td>
                        <td>Â¥${item.original_price.toFixed(2)}</td>
                        <td>${item.promotion}</td>
                        <td class="${priceClass}">Â¥${item.final_price.toFixed(2)}</td>
                        <td>${availabilityBadge}</td>
                        <td>${item.timestamp}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        // äº§å“å¯¹æ¯”
        function compareProducts(productInput) {
            const products = productInput.split(',').map(p => p.trim()).filter(p => p);
            if (products.length < 2) {
                alert('è¯·è¾“å…¥è‡³å°‘ä¸¤ä¸ªäº§å“è¿›è¡Œå¯¹æ¯”ï¼Œç”¨é€—å·åˆ†éš”');
                return;
            }
            
            showLoading('compareResults');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
            setTimeout(() => {
                const data = {};
                products.forEach(product => {
                    data[product] = generateRealtimeData(product.trim());
                });
                
                displayCompareResults(data);
            }, 800);
        }
        
        function displayCompareResults(data) {
            const container = document.getElementById('compareResults');
            let html = '<h3>äº§å“ä»·æ ¼å¯¹æ¯”</h3>';
            
            // å¯¹æ¯”è¡¨æ ¼
            html += '<table>';
            html += `
                <thead>
                    <tr>
                        <th>äº§å“</th>
                        <th>æœ€ä½ä»·</th>
                        <th>æœ€é«˜ä»·</th>
                        <th>å¹³å‡ä»·</th>
                        <th>åº—é“ºæ•°é‡</th>
                        <th>æœ€ä½ä»·å¹³å°</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            for (const [product, prices] of Object.entries(data)) {
                if (prices && prices.length > 0) {
                    const sortedPrices = [...prices].sort((a, b) => a.final_price - b.final_price);
                    const lowest = sortedPrices[0];
                    const highest = sortedPrices[sortedPrices.length - 1];
                    const avgPrice = prices.reduce((sum, item) => sum + item.final_price, 0) / prices.length;
                    
                    html += `
                        <tr>
                            <td><strong>${product}</strong></td>
                            <td class="price-low">Â¥${lowest.final_price.toFixed(2)}</td>
                            <td class="price-high">Â¥${highest.final_price.toFixed(2)}</td>
                            <td>Â¥${avgPrice.toFixed(2)}</td>
                            <td>${prices.length}</td>
                            <td>${lowest.platform}-${lowest.store_type}</td>
                        </tr>
                    `;
                }
            }
            
            html += '</tbody></table>';
            
            // è¯¦ç»†å¯¹æ¯”
            for (const [product, prices] of Object.entries(data)) {
                if (prices && prices.length > 0) {
                    html += `<h4>${product} ä»·æ ¼è¯¦æƒ…</h4>`;
                    html += '<table>';
                    html += `
                        <thead>
                            <tr>
                                <th>å¹³å°</th>
                                <th>åº—é“ºç±»å‹</th>
                                <th>åŸä»·</th>
                                <th>ä¿ƒé”€</th>
                                <th>åˆ°æ‰‹ä»·</th>
                                <th>åº“å­˜</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;
                    
                    prices.forEach(item => {
                        let availabilityBadge = '';
                        if (item.availability === 'æœ‰è´§') {
                            availabilityBadge = '<span class="availability-badge available">æœ‰è´§</span>';
                        } else if (item.availability === 'ç¼ºè´§') {
                            availabilityBadge = '<span class="availability-badge out-of-stock">ç¼ºè´§</span>';
                        } else {
                            availabilityBadge = '<span class="availability-badge preorder">é¢„è®¢</span>';
                        }
                        
                        html += `
                            <tr>
                                <td>${item.platform}</td>
                                <td>${item.store_type}</td>
                                <td>Â¥${item.original_price.toFixed(2)}</td>
                                <td>${item.promotion}</td>
                                <td>Â¥${item.final_price.toFixed(2)}</td>
                                <td>${availabilityBadge}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                }
            }
            
            container.innerHTML = html;
        }
        
        // ä»·æ ¼å†å²
        function showPriceHistory(productName) {
            if (!productName) {
                alert('è¯·è¾“å…¥äº§å“åç§°');
                return;
            }
            
            showLoading('historyChart');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
            setTimeout(() => {
                const data = {
                    product: productName,
                    history: generateHistoryData(productName)
                };
                
                displayPriceHistory(data);
            }, 800);
        }
        
        function displayPriceHistory(data) {
            const chartContainer = document.getElementById('historyChart');
            if (!data.history || data.history.length === 0) {
                chartContainer.innerHTML = '<div class="loading">æœªæ‰¾åˆ°ä»·æ ¼å†å²æ•°æ®</div>';
                return;
            }
            
            // æŒ‰å¹³å°åˆ†ç»„æ•°æ®
            const platformData = {};
            data.history.forEach(item => {
                const key = `${item.platform}-${item.store_type}`;
                if (!platformData[key]) {
                    platformData[key] = {x: [], y: [], timestamps: []};
                }
                platformData[key].x.push(item.timestamp);
                platformData[key].y.push(item.final_price);
                platformData[key].timestamps.push(item.timestamp);
            });
            
            const traces = Object.entries(platformData).map(([platform, values]) => {
                return {
                    x: values.x,
                    y: values.y,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: platform,
                    hovertemplate: '<b>%{fullData.name}</b><br>' +
                                   'ä»·æ ¼: Â¥%{y:.2f}<br>' +
                                   'æ—¶é—´: %{x}<extra></extra>'
                };
            });
            
            // å¦‚æœæ²¡æœ‰æŒ‰å¹³å°åˆ†ç»„çš„æ•°æ®ï¼Œåˆ›å»ºç»Ÿä¸€çš„æ•°æ®
            if (traces.length === 0) {
                const xValues = data.history.map(item => item.timestamp);
                const yValues = data.history.map(item => item.final_price);
                
                traces.push({
                    x: xValues,
                    y: yValues,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: data.product,
                    hovertemplate: '<b>%{fullData.name}</b><br>' +
                                   'ä»·æ ¼: Â¥%{y:.2f}<br>' +
                                   'æ—¶é—´: %{x}<extra></extra>'
                });
            }
            
            const layout = {
                title: `${data.product} ä»·æ ¼è¶‹åŠ¿å›¾`,
                xaxis: {
                    title: 'æ—¶é—´',
                    type: 'date'
                },
                yaxis: {
                    title: 'ä»·æ ¼ (Â¥)',
                    tickformat: '.2f'
                },
                hovermode: 'closest',
                legend: {
                    orientation: 'h',
                    yanchor: 'bottom',
                    y: 1.02,
                    xanchor: 'right',
                    x: 1
                }
            };
            
            Plotly.newPlot(chartContainer, traces, layout, {responsive: true});
        }
        
        // ç”ŸæˆæŠ¥å‘Š
        function generateReport(productName) {
            if (!productName) {
                alert('è¯·è¾“å…¥äº§å“åç§°');
                return;
            }
            
            showLoading('reportContent');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
            setTimeout(() => {
                const priceData = generateRealtimeData(productName);
                const avgPrice = priceData.reduce((sum, item) => sum + item.final_price, 0) / priceData.length;
                
                const data = {
                    product: productName,
                    report_date: new Date().toLocaleString(),
                    total_listings: priceData.length,
                    available_listings: priceData.filter(p => p.availability === 'æœ‰è´§').length,
                    lowest_price: Math.min(...priceData.map(item => item.final_price)),
                    highest_price: Math.max(...priceData.map(item => item.final_price)),
                    avg_price: parseFloat(avgPrice.toFixed(2)),
                    platform_pricing: (() => {
                        const platformMap = {};
                        priceData.forEach(item => {
                            if (!platformMap[item.platform]) {
                                platformMap[item.platform] = [];
                            }
                            platformMap[item.platform].push(item.final_price);
                        });
                        
                        const result = {};
                        for (const [platform, prices] of Object.entries(platformMap)) {
                            result[platform] = {
                                count: prices.length,
                                min: Math.min(...prices),
                                max: Math.max(...prices),
                                avg: parseFloat((prices.reduce((sum, p) => sum + p, 0) / prices.length).toFixed(2))
                            };
                        }
                        return result;
                    })(),
                    price_data: priceData,
                    market_insight: generateMarketInsight(priceData)
                };
                
                displayReport(data);
            }, 800);
        }
        
        function displayReport(data) {
            const container = document.getElementById('reportContent');
            let html = '';
            
            // æŠ¥å‘Šå¤´éƒ¨
            html += `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px;">
                    <h3 style="margin: 0;">${data.product} å¸‚åœºä»·æ ¼æŠ¥å‘Š</h3>
                    <p style="margin: 5px 0 0 0; opacity: 0.9;">ç”Ÿæˆæ—¶é—´: ${data.report_date}</p>
                </div>
            `;
            
            // å…³é”®æŒ‡æ ‡
            html += `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æœ€ä½å”®ä»·</h3>
                        <div class="value">Â¥${data.lowest_price.toFixed(2)}</div>
                        <div>å¸‚åœºæœ€ä¼˜ä»·</div>
                    </div>
                    <div class="stat-card">
                        <h3>æœ€é«˜å”®ä»·</h3>
                        <div class="value">Â¥${data.highest_price.toFixed(2)}</div>
                        <div>å¸‚åœºä»·æ ¼ä¸Šé™</div>
                    </div>
                    <div class="stat-card">
                        <h3>å¹³å‡å”®ä»·</h3>
                        <div class="value">Â¥${data.avg_price.toFixed(2)}</div>
                        <div>å¸‚åœºå‡ä»·</div>
                    </div>
                    <div class="stat-card">
                        <h3>åœ¨å”®åº—é“º</h3>
                        <div class="value">${data.available_listings}/${data.total_listings}</div>
                        <div>å¯è´­ä¹°/æ€»æ•°é‡</div>
                    </div>
                </div>
            `;
            
            // å¸‚åœºæ´å¯Ÿ
            if (data.market_insight) {
                html += `<div class="market-insight"><strong>ğŸ“Š å¸‚åœºæ´å¯Ÿ:</strong> ${data.market_insight}</div>`;
            }
            
            // å¹³å°ä»·æ ¼åˆ†æ
            html += '<h3>å¹³å°ä»·æ ¼åˆ†æ</h3>';
            html += '<table>';
            html += `
                <thead>
                    <tr>
                        <th>å¹³å°</th>
                        <th>åº—é“ºæ•°é‡</th>
                        <th>æœ€ä½ä»·</th>
                        <th>æœ€é«˜ä»·</th>
                        <th>å¹³å‡ä»·</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            for (const [platform, stats] of Object.entries(data.platform_pricing)) {
                html += `
                    <tr>
                        <td><span class="platform-color ${platform.toLowerCase().replace('çº¿ä¸‹', 'offline')}" title="${platform}"></span>${platform}</td>
                        <td>${stats.count}</td>
                        <td class="price-low">Â¥${stats.min.toFixed(2)}</td>
                        <td class="price-high">Â¥${stats.max.toFixed(2)}</td>
                        <td>Â¥${stats.avg.toFixed(2)}</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            
            // è¯¦ç»†ä»·æ ¼æ•°æ®
            html += '<h3>è¯¦ç»†ä»·æ ¼æ•°æ®</h3>';
            html += '<table>';
            html += `
                <thead>
                    <tr>
                        <th>å¹³å°</th>
                        <th>åº—é“ºç±»å‹</th>
                        <th>å“ç‰Œ</th>
                        <th>åŸä»·</th>
                        <th>ä¿ƒé”€</th>
                        <th>åˆ°æ‰‹ä»·</th>
                        <th>åº“å­˜</th>
                        <th>æ—¶é—´</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            data.price_data.forEach(item => {
                let availabilityBadge = '';
                if (item.availability === 'æœ‰è´§') {
                    availabilityBadge = '<span class="availability-badge available">æœ‰è´§</span>';
                } else if (item.availability === 'ç¼ºè´§') {
                    availabilityBadge = '<span class="availability-badge out-of-stock">ç¼ºè´§</span>';
                } else {
                    availabilityBadge = '<span class="availability-badge preorder">é¢„è®¢</span>';
                }
                
                html += `
                    <tr>
                        <td>${item.platform}</td>
                        <td>${item.store_type}</td>
                        <td>${item.brand}</td>
                        <td>Â¥${item.original_price.toFixed(2)}</td>
                        <td>${item.promotion}</td>
                        <td>Â¥${item.final_price.toFixed(2)}</td>
                        <td>${availabilityBadge}</td>
                        <td>${item.timestamp}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            
            container.innerHTML = html;
        }
        
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading">æ•°æ®åŠ è½½ä¸­...</div>';
        }
        
        // è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿå®æ—¶æ›´æ–°ï¼‰
        function setupAutoRefresh() {
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°å½“å‰æ˜¾ç¤ºçš„äº§å“æ•°æ®
            setInterval(() => {
                if (document.getElementById('monitor').classList.contains('active')) {
                    // åªåœ¨ä»·æ ¼ç›‘æ§æ ‡ç­¾é¡µæ¿€æ´»æ—¶æ›´æ–°
                    const searchInput = document.getElementById('searchInput').value;
                    if (searchInput) {
                        const priceData = generateRealtimeData(searchInput);
                        if (priceData) {
                            console.log(`è‡ªåŠ¨æ›´æ–° ${searchInput} çš„ä»·æ ¼æ•°æ®`);
                            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´æ˜¾ç¤º
                            if (lastUpdateTimes[searchInput]) {
                                document.getElementById('lastUpdatedMonitor').textContent = `æœ€åæ›´æ–°: ${lastUpdateTimes[searchInput]}`;
                            }
                        }
                    }
                }
            }, 30000); // 30ç§’
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æŸ¥è¯¢é»˜è®¤äº§å“
        window.onload = function() {
            // è®¾ç½®é»˜è®¤äº§å“åè¾“å…¥æ¡†ç„¦ç‚¹
            document.getElementById('searchInput').focus();
            
            // è®¾ç½®äº§å“å»ºè®®åŠŸèƒ½
            setupProductSuggestions();
            
            // è®¾ç½®è‡ªåŠ¨åˆ·æ–°
            setupAutoRefresh();
        };
    </script>
</body>
</html>
